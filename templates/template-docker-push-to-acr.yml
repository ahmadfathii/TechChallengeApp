  jobs: 
    - job: Build
      pool:
        vmImage: ubuntu-latest 
      displayName: Build image
      steps:
      - task: replacetokens@5
        displayName: replace token on Dockerfile
        inputs:
          targetFiles: '**/Dockerfile'
          encoding: 'auto'
          tokenPattern: 'doublebraces'
          writeBOM: true
          actionOnMissing: 'warn'
          keepToken: false
          actionOnNoFiles: 'continue'
          enableTransforms: false
          enableRecursion: false
          useLegacyPattern: false
          enableTelemetry: true
      - task: replacetokens@5
        displayName: replace token on config
        inputs:
          targetFiles: '**/conf.toml'
          encoding: 'auto'
          tokenPattern: 'doublebraces'
          writeBOM: true
          actionOnMissing: 'warn'
          keepToken: false
          actionOnNoFiles: 'continue'
          enableTransforms: false
          enableRecursion: false
          useLegacyPattern: false
          enableTelemetry: true
      - task: Docker@2
        displayName: Build-push image to ACR
        inputs:
          command: buildAndPush
          repository: ${{ parameters.repository }}
          dockerfile: ${{ parameters.dockerfile }}
          containerRegistry: ${{ parameters.containerRegistry }}
          tags: '$(Build.BuildId)'
